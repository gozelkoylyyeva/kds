<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HotelVision - Otel Karar Destek Sistemi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.1.0/dist/chartjs-plugin-datalabels.min.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="/views/style.css">
</head>
<body>
<div class="container-fluid">
    <div class="row">
        <div class="col-md-2 sidebar p-0 d-flex flex-column" style="min-height: 100vh;">
            <div class="text-center py-5 mb-4 px-3 border-bottom border-secondary">
                <div class="d-flex align-items-center justify-content-center mb-3">
                    <div class="position-relative">
                        <div class="kpi-icon text-primary" style="width: 56px; height: 56px; margin-bottom: 0; background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(139, 92, 246, 0.2)); box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);">
                        <i class="fas fa-hotel"></i>
                        </div>
                        <div class="position-absolute top-0 start-100 translate-middle">
                            <span class="badge bg-success rounded-pill" style="font-size: 0.6rem; padding: 2px 6px;">
                                <i class="fas fa-circle" style="font-size: 0.4rem;"></i>
                            </span>
                        </div>
                    </div>
                </div>
                <div class="text-start px-2">
                    <div class="fw-bold fs-5 text-primary m-0 mb-1" style="letter-spacing: -0.5px;">HotelVision</div>
                    <small class="text-muted d-block mb-2" style="font-size: 0.7rem; font-weight: 500;">Karar Destek Platformu</small>
                    <div class="badge bg-gradient text-white px-3 py-1" style="font-size: 0.7rem; font-weight: 600; border-radius: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                        <i class="fas fa-chart-line me-1"></i>Akıllı Analiz
                    </div>
                </div>
            </div>
            
            <div class="px-2 flex-grow-1">
                <a onclick="window.sayfaDegistir('sayfa-ozet', this)" class="menu-link active">
                    <i class="fas fa-chart-pie"></i>
                    <span>Genel Bakış</span>
                </a>
                <a onclick="window.sayfaDegistir('sayfa-simulasyon', this)" class="menu-link">
                    <i class="fas fa-brain"></i>
                    <span>Strateji Simülatörü</span>
                </a>
            </div>
            
        </div>

        <div class="col-md-10 content-area p-4">
            
            <div id="sayfa-ozet" class="page-section active">
                <!-- Dashboard Header - Power BI/Excel Style -->
                <div class="d-flex justify-content-between align-items-center mb-4 pb-3 border-bottom" style="border-color: #e2e8f0 !important;">
                    <div>
                        <h1 class="page-title m-0 fw-bold" style="font-size: 1.75rem; color: #1e293b;">
                            <i class="fas fa-chart-line me-3" style="color: #3b82f6;"></i>Genel Durum Özeti
                        </h1>
                    </div>
                    <div class="d-flex gap-2">
                        <button class="btn btn-outline-secondary btn-sm" onclick="refreshDashboard()" title="Yenile">
                            <i class="fas fa-sync-alt me-1"></i>Yenile
                        </button>
                    </div>
                </div>
                
                
                <!-- KPI Kartları - Power BI/Excel Style -->
                <div class="row g-4 mb-4" id="gelismisKPI">
                    <div class="col-lg-3 col-md-6">
                        <div class="card kpi-card border-primary shadow-sm border-0 p-4" style="cursor: pointer; transition: transform 0.2s;" onclick="kpiDetayAc('doluluk')" onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'">
                            <div class="d-flex align-items-center justify-content-between mb-3">
                                <div class="kpi-icon text-primary">
                                    <i class="fas fa-bed"></i>
                                </div>
                                <div class="text-end">
                                    <small class="text-muted d-block mb-1 fw-semibold">Doluluk Oranı</small>
                                    <h2 class="kpi-value m-0 fw-bold" id="kpiDoluluk">-</h2>
                                </div>
                            </div>
                            <div class="d-flex align-items-center mb-2" id="kpiDolulukDegisim">
                                <i class="fas fa-arrow-up me-2 text-success"></i>
                                <span class="small">-</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6">
                        <div class="card kpi-card border-success shadow-sm border-0 p-4" style="cursor: pointer; transition: transform 0.2s;" onclick="kpiDetayAc('gelir')" onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'">
                            <div class="d-flex align-items-center justify-content-between mb-3">
                                <div class="kpi-icon text-success">
                                    <i class="fas fa-lira-sign"></i>
                                </div>
                                <div class="text-end">
                                    <small class="text-muted d-block mb-1 fw-semibold">Toplam Gelir</small>
                                    <h2 class="kpi-value m-0 fw-bold" id="kpiGelir">-</h2>
                                </div>
                            </div>
                            <div class="d-flex align-items-center mb-2" id="kpiGelirDegisim">
                                <i class="fas fa-arrow-up me-2 text-success"></i>
                                <span class="small">-</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6">
                        <div class="card kpi-card border-warning shadow-sm border-0 p-4" style="cursor: pointer; transition: transform 0.2s;" onclick="kpiDetayAc('karMarji')" onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'">
                            <div class="d-flex align-items-center justify-content-between mb-3">
                                <div class="kpi-icon text-warning">
                                    <i class="fas fa-chart-pie"></i>
                                </div>
                                <div class="text-end">
                                    <small class="text-muted d-block mb-1 fw-semibold">Kar Marjı</small>
                                    <h2 class="kpi-value m-0 fw-bold" id="kpiKarMarji">-</h2>
                                </div>
                            </div>
                            <div class="d-flex align-items-center mb-2" id="kpiKarMarjiDegisim">
                                <i class="fas fa-arrow-up me-2 text-success"></i>
                                <span class="small">-</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6">
                        <div class="card kpi-card border-danger shadow-sm border-0 p-4" style="cursor: pointer; transition: transform 0.2s;" onclick="kpiDetayAc('iptalOrani')" onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'">
                            <div class="d-flex align-items-center justify-content-between mb-3">
                                <div class="kpi-icon text-danger">
                                    <i class="fas fa-times-circle"></i>
                                </div>
                                <div class="text-end">
                                    <small class="text-muted d-block mb-1 fw-semibold">İptal Oranı</small>
                                    <h2 class="kpi-value m-0 fw-bold" id="kpiIptalOrani">-</h2>
                                </div>
                            </div>
                            <div class="d-flex align-items-center mb-2" id="kpiIptalOraniDegisim">
                                <i class="fas fa-arrow-down me-2 text-danger"></i>
                                <span class="small">-</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Aylık Rezervasyon Trendi ve Rakip Fiyat Analizi - Yan Yana -->
                <div class="row g-4 mb-4">
                    <div class="col-lg-6">
                        <div class="card shadow-sm border-0 p-4 h-100">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h5 class="mb-0 fw-bold"><i class="fas fa-chart-area me-2 text-primary"></i>Aylık Rezervasyon Trendi</h5>
                            </div>
                            <div style="height:450px; position:relative;">
                                <canvas id="dolulukGrafigi"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="card shadow-sm border-0 p-4 border-warning border-start border-4 h-100">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h5 class="mb-0 fw-bold"><i class="fas fa-balance-scale me-2 text-warning"></i>Rakip Fiyat Analizi</h5>
                                <button class="btn btn-sm btn-outline-warning" onclick="rakipFiyatAnaliziYukle()">
                                    <i class="fas fa-sync-alt me-1"></i>Yenile
                                </button>
                            </div>
                            <div id="pazarAnaliziBilgi"></div>
                            <div id="rakipFiyatListesi" style="height:450px; position:relative;">
                                <canvas id="rakipFiyatGrafigi"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                    <!-- Gelecek Tahminleri ve Stratejiler -->
                <div class="row g-4 mt-4">
                    
                    <!-- Doluluk Tahmini ve Gelir-Kâr Tahmini - Yan Yana -->
                    <div class="col-lg-6">
                        <div class="card shadow-sm border-0 p-4 border-primary border-start border-4 h-100">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h5 class="mb-0 fw-bold"><i class="fas fa-calendar-alt me-2 text-primary"></i>Doluluk Tahmini</h5>
                                <div class="btn-group btn-group-sm">
                                    <button class="btn btn-outline-primary active" onclick="dolulukTahminiPeriyotDegistir(6, this)" id="dolulukTahminiBtn6">6 Ay</button>
                                    <button class="btn btn-outline-primary" onclick="dolulukTahminiPeriyotDegistir(12, this)" id="dolulukTahminiBtn12">12 Ay</button>
                                </div>
                            </div>
                            <div id="dolulukTahminiListesi" style="height:450px; position:relative;">
                                <canvas id="dolulukTahminiGrafigi"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-6">
                        <div class="card shadow-sm border-0 p-4 border-success border-start border-4 h-100">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h5 class="mb-0 fw-bold"><i class="fas fa-chart-line me-2 text-success"></i>Gelir ve Kâr Tahmini</h5>
                                <div class="btn-group btn-group-sm">
                                    <button class="btn btn-outline-success active" onclick="gelirKarTahminiPeriyotDegistir(6, this)" id="gelirKarTahminiBtn6">6 Ay</button>
                                    <button class="btn btn-outline-success" onclick="gelirKarTahminiPeriyotDegistir(12, this)" id="gelirKarTahminiBtn12">12 Ay</button>
                                </div>
                            </div>
                            <div id="gelirKarTahminiListesi" style="height:450px; position:relative;">
                                <canvas id="gelirKarTahminiGrafigi"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Yıllık Karşılaştırma ve Personel İhtiyacı - Yan Yana -->
                    <div class="col-lg-6">
                        <div class="card shadow-sm border-0 p-4 border-info border-start border-4 h-100">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h5 class="mb-0 fw-bold"><i class="fas fa-calendar-check me-2 text-info"></i>Yıllık Karşılaştırma</h5>
                                <button class="btn btn-sm btn-outline-info" onclick="yillikKarsilastirmaYukle()">
                                    <i class="fas fa-sync-alt me-1"></i>Yenile
                                </button>
                            </div>
                            <div id="yillikKarsilastirmaBilgi" class="mb-3"></div>
                            <div id="yillikKarsilastirmaTablosu" class="table-responsive mb-3" style="max-height: 180px; overflow-y: auto;"></div>
                            <div id="yillikKarsilastirmaGrafigi" style="height:380px; position:relative;">
                                <canvas id="yillikKarsilastirmaChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-6">
                        <div class="card shadow-sm border-0 p-4 border-info border-start border-4 h-100">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h5 class="mb-0 fw-bold"><i class="fas fa-users me-2 text-info"></i>Personel İhtiyacı Tahmini</h5>
                            </div>
                            <div class="row g-4">
                                <div class="col-12">
                                    <div id="personelIhtiyaciListesi" class="table-responsive mb-3">
                                        <table class="table table-sm table-hover">
                                            <thead class="table-light">
                                                <tr>
                                                    <th>Departman</th>
                                                    <th>Mevcut</th>
                                                    <th>Önerilen</th>
                                                    <th>Fark</th>
                                                </tr>
                                            </thead>
                                            <tbody id="personelIhtiyaciTablosu">
                                                <tr><td colspan="4" class="text-center text-muted"></td></tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div style="height:400px; position:relative;">
                                        <canvas id="personelIhtiyaciGrafigi"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                </div>
            </div>

            <div id="sayfa-simulasyon" class="page-section">
                <!-- Başlık -->
                <div class="mb-4">
                    <h1 class="page-title m-0"><i class="fas fa-brain me-3 text-primary"></i>Strateji Simülatörü</h1>
                </div>
                
                <!-- Kontroller - Üstte Yan Yana -->
                <div class="row g-3 mb-4">
                    <div class="col-md-4">
                        <div class="card p-4 border-start border-4 border-primary shadow-sm">
                            <h6 class="text-primary fw-bold mb-3 text-uppercase"><i class="fas fa-tag me-2"></i>Fiyat Politikası</h6>
                            <label for="fiyatDegisimiSlider" class="text-muted small mb-2 d-flex justify-content-between">Fiyat Değişimi <span id="fiyatDegisimiLabel" class="fw-bold text-primary">0%</span></label>
                            <input type="range" class="form-range" min="-50" max="50" step="1" value="0" id="fiyatDegisimiSlider">
                            <div class="input-group mt-2">
                                <input type="number" id="fiyatDegisimiInput" class="form-control form-control-sm fw-bold text-center" value="0" min="-50" max="50">
                                <span class="input-group-text bg-light border-secondary"><i class="fas fa-percent"></i></span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card p-4 border-start border-4 border-info shadow-sm">
                            <h6 class="text-info fw-bold mb-3 text-uppercase"><i class="fas fa-users me-2"></i>Personel Sayısı</h6>
                            <label for="personelSayisiInput" class="text-muted small mb-2 d-block">Personel Sayısı</label>
                            <div class="input-group">
                                <input type="number" id="personelSayisiInput" class="form-control fw-bold text-center" value="20" placeholder="Örn: 25, 30, 50" style="font-size: 1.1rem; padding: 12px;" step="1" inputmode="numeric" pattern="[0-9]*">
                                <span class="input-group-text bg-light border-secondary"><i class="fas fa-user"></i></span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card p-4 border-start border-4 border-warning shadow-sm">
                            <h6 class="text-warning fw-bold mb-3 text-uppercase"><i class="fas fa-bullhorn me-2"></i>Pazarlama Bütçesi</h6>
                            <label for="pazarlamaButcesiInput" class="text-muted small mb-2 d-block">Aylık Bütçe (₺)</label>
                            <div class="input-group">
                                <input type="number" id="pazarlamaButcesiInput" class="form-control fw-bold text-center" value="0" placeholder="Pazarlama bütçesini girin" style="font-size: 1.1rem; padding: 12px;">
                                <span class="input-group-text bg-light border-secondary">₺</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Simüle Et ve Senaryo Kaydet Butonları -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="d-flex gap-3">
                            <button class="btn btn-primary btn-lg px-5 fw-bold shadow-lg" onclick="window.fiyatSimulasyonuYap()">
                                <i class="fas fa-rocket me-2"></i>SİMÜLE ET
                            </button>
                            <button class="btn btn-success btn-lg px-5 fw-bold shadow-lg" onclick="window.senaryoKaydet()" id="senaryoKaydetBtn" style="display:none;">
                                <i class="fas fa-save me-2"></i>SENARYOYU KAYDET
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Grafikler ve Analizler - Altta -->
                <div class="row">
                    <div class="col-12">
                        <div class="row g-3 mb-3" id="kpiRow" style="display:none;">
                            <div class="col-md-4"><div class="card p-3 text-center border-bottom border-4 border-info"><small class="text-muted text-uppercase fw-bold">Tahmini Ciro</small><h3 class="text-white fw-bold m-0" id="kpiCiro">0 ₺</h3></div></div>
                            <div class="col-md-4"><div class="card p-3 text-center border-bottom border-4" id="kpiKarCard"><small class="text-muted text-uppercase fw-bold">Net Kâr Farkı</small><h3 class="text-white fw-bold m-0" id="kpiFark">0 ₺</h3></div></div>
                            <div class="col-md-4"><div class="card p-3 text-center border-bottom border-4 border-warning"><small class="text-muted text-uppercase fw-bold">Yeni Kâr Marjı</small><h3 class="text-white fw-bold m-0" id="kpiMarj">%0</h3></div></div>
                        </div>
                        <div class="row g-3" id="chartRow" style="display:none;">
                            <div class="col-md-12 mb-3"><div class="card p-4"><h6 class="text-muted mb-3 text-uppercase fw-bold"><i class="fas fa-chart-bar me-2"></i>Senaryo Karşılaştırması - Net Kâr Analizi</h6><div style="height:350px"><canvas id="senaryoGrafigi"></canvas></div></div></div>
                            <div class="col-md-6" id="ciroGrafikKolon" style="display:none;"><div class="card p-4"><h6 class="text-muted mb-3 text-uppercase fw-bold"><i class="fas fa-chart-line me-2"></i>Ciro Karşılaştırması</h6><div style="height:250px"><canvas id="ciroGrafigi"></canvas></div></div></div>
                        </div>
                        <!-- Senaryo Karşılaştırma Tablosu -->
                        <div class="row mt-4" id="senaryoKarsilastirmaRow" style="display:none;">
                            <div class="col-12">
                                <div class="card p-4 border-success border-start border-4">
                                    <h6 class="mb-3"><i class="fas fa-table me-2"></i>Senaryo Karşılaştırması</h6>
                                    <div class="table-responsive">
                                        <table class="table table-sm table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Senaryo</th>
                                                    <th>Beklenen Gelir</th>
                                                    <th>Net Kâr</th>
                                                    <th>Risk Seviyesi</th>
                                                    <th>Değerlendirilebilir mi?</th>
                                                    <th>Analiz Yorumu</th>
                                                </tr>
                                            </thead>
                                            <tbody id="senaryoKarsilastirmaTablosu">
                                                <tr><td colspan="6" class="text-center text-muted">Simülasyon yapıldığında görünecek</td></tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Detaylı Analiz ve Grafikler -->
                        <div class="row g-4 mt-4">
                            <div class="col-12">
                                <h4 class="mb-4"><i class="fas fa-chart-line me-2 text-primary"></i>Detaylı Analiz ve Grafikler</h4>
                            </div>
                            
                            <!-- Gelir Trend Analizi ve Tahmin Doğruluğu - Yan Yana -->
                            <div class="col-lg-6">
                                <div class="card p-4 h-100">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <div>
                                            <h5 class="mb-1"><i class="fas fa-chart-line me-2 text-primary"></i>Gelir Trend Analizi</h5>
                                            <small class="text-muted">Aylık gelir ve rezervasyon trendi</small>
                                        </div>
                                    </div>
                                    <div style="height:350px; position:relative;">
                                        <canvas id="gelirTrendGrafigi"></canvas>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="card p-4 h-100">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <div>
                                            <h5 class="mb-1"><i class="fas fa-bullseye me-2 text-info"></i>Tahmin Doğruluğu</h5>
                                            <small class="text-muted">Gerçek vs tahmin karşılaştırması</small>
                                        </div>
                                    </div>
                                    <div style="height:350px; position:relative;">
                                        <canvas id="tahminDogruluguGrafigi"></canvas>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Doluluk Analizi ve Fiyat Analizi - Yan Yana -->
                            <div class="col-lg-6">
                                <div class="card p-4 h-100" style="overflow:visible;">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <div>
                                            <h5 class="mb-1"><i class="fas fa-chart-bar me-2 text-success"></i>Doluluk Analizi</h5>
                                            <small class="text-muted">Geçmiş ve Gelecek Performans</small>
                                        </div>
                                        <div class="btn-group btn-group-sm">
                                            <button class="btn btn-outline-success active" onclick="dolulukGrafigiDegistir('gecmis', this)">Geçmiş</button>
                                            <button class="btn btn-outline-success" onclick="dolulukGrafigiDegistir('tahmin-6', this)">Tahmin 6A</button>
                                            <button class="btn btn-outline-success" onclick="dolulukGrafigiDegistir('tahmin-12', this)">Tahmin 12A</button>
                                        </div>
                                    </div>
                                    <div style="height:450px; position:relative; overflow:visible; min-height:450px;">
                                        <canvas id="dolulukOraniGrafigi"></canvas>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="card p-4 h-100">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <div>
                                            <h5 class="mb-1"><i class="fas fa-balance-scale me-2 text-primary"></i>Fiyat Analizi</h5>
                                            <small class="text-muted">Esneklik ve Trendler</small>
                                        </div>
                                        <div class="btn-group btn-group-sm">
                                            <button class="btn btn-outline-primary active" onclick="fiyatGrafigiDegistir('analiz', this)">Esneklik Analizi</button>
                                            <button class="btn btn-outline-primary" onclick="fiyatGrafigiDegistir('gecmis', this)">Geçmiş Trend</button>
                                        </div>
                                    </div>
                                    <div style="height:450px; position:relative;">
                                        <canvas id="fiyatEsneklikGrafigi"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mt-4">
                            <div class="col-12">
                                <div class="card p-4">
                                    <h6 class="mb-3"><i class="fas fa-history me-2"></i>Kaydedilen Senaryolar</h6>
                                    <div class="table-responsive">
                                        <table class="table table-sm table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Tarih</th>
                                                    <th>Senaryo Adı</th>
                                                    <th>Tip</th>
                                                    <th>Tahmini Kâr</th>
                                                    <th>Durum</th>
                                                    <th>İşlemler</th>
                                                </tr>
                                            </thead>
                                            <tbody id="senaryoListesi">
                                                <tr><td colspan="5" class="text-center text-muted">Henüz senaryo kaydedilmedi</td></tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
                </div>
            </div>


                            </div>
                            </div>
                        </div>

<div class="modal fade" id="dovizModal" tabindex="-1"><div class="modal-dialog modal-lg modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="dovizModalBaslik"></h5><button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button></div><div class="modal-body"><div style="height:350px"><canvas id="dovizDetayGrafigi"></canvas></div></div></div></div>    </div>

    <!-- KPI Detay Modal -->
    <div class="modal fade" id="kpiDetayModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content shadow-lg">
                <div class="modal-header">
                    <h5 class="modal-title fw-bold" id="kpiDetayBaslik">KPI Detay Analizi</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div>
                            <small class="text-muted">Periyot Seçimi</small>
                        </div>
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-outline-primary" onclick="kpiDetayPeriyotDegistir(6)" id="kpiDetayPeriyot6">6 Ay</button>
                            <button class="btn btn-outline-primary" onclick="kpiDetayPeriyotDegistir(12)" id="kpiDetayPeriyot12">12 Ay</button>
                        </div>
                    </div>
                    <div style="height: 400px;">
                        <canvas id="kpiDetayGrafigi"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Premium Analytics Modal -->
    <div class="modal fade" id="odaDetayModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-xl">
            <div class="modal-content shadow-lg">
                <div class="modal-header">
                    <div><h5 class="modal-title fw-bold" id="modalOdaBaslik">Detay Analizi</h5><small class="text-muted">Kaynak: Booking DB & Google Hotels API</small></div>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4">
                    <div id="bolumGrafik" class="d-none animate-fade">
                        <div class="d-flex align-items-center mb-4"><div class="p-2 bg-info bg-opacity-10 rounded me-3"><i class="fas fa-history text-info"></i></div><h6 class="m-0 text-info">Fiyat Geçmişi (2023-2025)</h6></div>
                        <div class="p-3 rounded-4 bg-light border"><div style="height: 400px;"><canvas id="detayGrafigi"></canvas></div></div>
                    </div>
                    <div id="bolumRakip" class="d-none animate-fade">
                        <div class="row">
                            <div class="col-lg-7 mb-4 mb-lg-0">
                                <div class="d-flex align-items-center mb-4"><div class="p-2 bg-warning bg-opacity-10 rounded me-3"><i class="fas fa-balance-scale text-warning"></i></div><h6 class="m-0 text-warning">Pazar Karşılaştırması</h6></div>
                                <div class="p-3 rounded-4 bg-light border"><div style="height: 300px;"><canvas id="rakipGrafigiAnalytics"></canvas></div></div>
                            </div>
                            <div class="col-lg-5">
                                <h6 class="mb-3">Rakip Listesi (Google)</h6>
                                <div class="table-responsive">
                                    <table class="table table-hover table-sm">
                                        <thead class="table-light">
                                            <tr>
                                                <th>Otel</th>
                                                <th class="text-end">Fiyat</th>
                                                <th class="text-end">Fark</th>
                                                <th class="text-end">Durum</th>
                                            </tr>
                                        </thead>
                                        <tbody id="modalRakipListesi"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Fiyat Detay Modalı (Geçmiş Trend Tıklaması İçin) -->
    <div class="modal fade" id="fiyatDetayModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="fiyatDetayModalBaslik">Fiyat Dağılımı</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div style="height:350px"><canvas id="fiyatDetayGrafigiCanvas"></canvas></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Senaryo Raporu Modalı -->
    <div class="modal fade" id="senaryoRaporModal" tabindex="-1" aria-labelledby="senaryoRaporModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="senaryoRaporModalLabel">
                        <i class="fas fa-file-alt me-2"></i>Senaryo Raporu
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="senaryoRaporIcerik">
                    <div class="text-center py-5">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Yükleniyor...</span>
                        </div>
                        <p class="mt-3 text-muted">Rapor yükleniyor...</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="senaryoRaporIndirBtn" onclick="window.senaryoRaporuIndir()">
                        <i class="fas fa-download me-2"></i>PDF İndir
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Kapat</button>
                </div>
            </div>
        </div>
    </div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<!-- Ana JavaScript Fonksiyonları -->
<script>
// Sayfa değiştirme fonksiyonu
window.sayfaDegistir = function(sayfaId, element) {
    // Tüm sayfaları gizle
    document.querySelectorAll('.page-section').forEach(section => {
        section.classList.remove('active');
    });
    
    // Seçilen sayfayı göster
    const sayfa = document.getElementById(sayfaId);
    if (sayfa) {
        sayfa.classList.add('active');
    }
    
    // Menü linklerini güncelle
    document.querySelectorAll('.menu-link').forEach(link => {
        link.classList.remove('active');
    });
    if (element) {
        element.classList.add('active');
    }
};

// Doluluk tahmini periyot değiştirme
let dolulukTahminiChart = null;
window.dolulukTahminiPeriyotDegistir = function(months, button) {
    // Buton durumlarını güncelle
    document.querySelectorAll('#dolulukTahminiBtn6, #dolulukTahminiBtn12').forEach(btn => {
        btn.classList.remove('active');
    });
    if (button) button.classList.add('active');
    
    // Grafik yükle
    fetch(`/api/dashboard/doluluk-tahmini?months=${months}`)
        .then(response => response.json())
        .then(data => {
            const ctx = document.getElementById('dolulukTahminiGrafigi');
            if (!ctx) return;
            
            if (dolulukTahminiChart) dolulukTahminiChart.destroy();
            
            const tahminler = data.tahminler || [];
            const labels = tahminler.map(t => t.ay);
            const values = tahminler.map(t => t.tahmini_doluluk || t.tahmini_doluluk_araligi?.ortalama || 0);
            
            dolulukTahminiChart = new Chart(ctx.getContext('2d'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Doluluk Tahmini (%)',
                        data: values,
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.parsed.y.toFixed(1) + '%';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            grid: { color: 'rgba(0,0,0,0.05)' }
                        },
                        x: {
                            grid: { display: false }
                        }
                    }
                }
            });
        })
        .catch(err => console.error('Doluluk tahmini yüklenemedi:', err));
};

// Gelir-Kar tahmini periyot değiştirme
let gelirKarTahminiChart = null;
window.gelirKarTahminiPeriyotDegistir = function(months, button) {
    // Buton durumlarını güncelle
    document.querySelectorAll('#gelirKarTahminiBtn6, #gelirKarTahminiBtn12').forEach(btn => {
        btn.classList.remove('active');
    });
    if (button) button.classList.add('active');
    
    // Grafik yükle
    fetch(`/api/dashboard/gelir-kar-tahmini?months=${months}`)
        .then(response => response.json())
        .then(data => {
            const ctx = document.getElementById('gelirKarTahminiGrafigi');
            if (!ctx) return;
            
            if (gelirKarTahminiChart) gelirKarTahminiChart.destroy();
            
            const tahminler = data.tahminler || [];
            const labels = tahminler.map(t => t.donem);
            const gelirData = tahminler.map(t => t.tahmini_gelir || t.tahmini_gelir_araligi?.ortalama || 0);
            const karData = tahminler.map(t => t.tahmini_kar || t.tahmini_kar_araligi?.ortalama || 0);
            
            gelirKarTahminiChart = new Chart(ctx.getContext('2d'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Gelir',
                            data: gelirData,
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Kâr',
                            data: karData,
                            borderColor: '#f59e0b',
                            backgroundColor: 'rgba(245, 158, 11, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top' },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.parsed.y.toLocaleString('tr-TR') + ' ₺';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            beginAtZero: true,
                            grid: { color: 'rgba(0,0,0,0.05)' },
                            ticks: {
                                callback: function(value) {
                                    return (value / 1000000).toFixed(1) + 'M';
                                }
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            beginAtZero: true,
                            grid: { drawOnChartArea: false },
                            ticks: {
                                callback: function(value) {
                                    return (value / 1000000).toFixed(1) + 'M';
                                }
                            }
                        },
                        x: {
                            grid: { display: false }
                        }
                    }
                }
            });
        })
        .catch(err => console.error('Gelir-Kar tahmini yüklenemedi:', err));
};

// Doluluk grafiği değiştirme
let dolulukOraniChart = null;
window.dolulukGrafigiDegistir = function(tip, button) {
    // Buton durumlarını güncelle
    const buttons = button.parentElement.querySelectorAll('button');
    buttons.forEach(btn => btn.classList.remove('active'));
    if (button) button.classList.add('active');
    
    const ctx = document.getElementById('dolulukOraniGrafigi');
    if (!ctx) return;
    
    if (dolulukOraniChart) dolulukOraniChart.destroy();
    
    if (tip === 'gecmis') {
        // Geçmiş doluluk oranı
        fetch('/api/doluluk-orani')
            .then(response => response.json())
            .then(data => {
                const labels = data.map(d => {
                    const [yil, ay] = d.ay.split('-');
                    const date = new Date(yil, ay - 1, 1);
                    return date.toLocaleDateString('tr-TR', { month: 'short', year: 'numeric' });
                });
                const values = data.map(d => d.doluluk_orani);
                
                dolulukOraniChart = new Chart(ctx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Doluluk Oranı (%)',
                            data: values,
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return context.parsed.y.toFixed(1) + '%';
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                grid: { color: 'rgba(0,0,0,0.05)' }
                            },
                            x: {
                                grid: { display: false }
                            }
                        }
                    }
                });
            })
            .catch(err => console.error('Doluluk oranı yüklenemedi:', err));
    } else if (tip === 'tahmin-6' || tip === 'tahmin-12') {
        // Tahmin
        const months = tip === 'tahmin-6' ? 6 : 12;
        fetch(`/api/dashboard/doluluk-tahmini?months=${months}`)
            .then(response => response.json())
            .then(data => {
                dolulukOraniChart = new Chart(ctx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: data.labels || [],
                        datasets: [{
                            label: 'Doluluk Tahmini (%)',
                            data: data.values || [],
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return context.parsed.y.toFixed(1) + '%';
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                grid: { color: 'rgba(0,0,0,0.05)' }
                            },
                            x: {
                                grid: { display: false }
                            }
                        }
                    }
                });
            })
            .catch(err => console.error('Doluluk tahmini yüklenemedi:', err));
    }
};

// Fiyat grafiği değiştirme
let fiyatEsneklikChart = null;
window.fiyatGrafigiDegistir = function(tip, button) {
    // Buton durumlarını güncelle
    const buttons = button.parentElement.querySelectorAll('button');
    buttons.forEach(btn => btn.classList.remove('active'));
    if (button) button.classList.add('active');
    
    const ctx = document.getElementById('fiyatEsneklikGrafigi');
    if (!ctx) return;
    
    if (fiyatEsneklikChart) fiyatEsneklikChart.destroy();
    
    if (tip === 'analiz') {
        // Fiyat esneklik analizi
        fetch('/api/fiyat-esneklik')
            .then(response => response.json())
            .then(data => {
                const labels = data.map(d => d.fiyat_degisim + '%');
                const gelirValues = data.map(d => d.gelir);
                
                fiyatEsneklikChart = new Chart(ctx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Gelir (₺)',
                            data: gelirValues,
                            backgroundColor: data.map((d, i) => {
                                if (d.fiyat_degisim < 0) return 'rgba(16, 185, 129, 0.8)';
                                if (d.fiyat_degisim === 0) return 'rgba(59, 130, 246, 0.8)';
                                return 'rgba(239, 68, 68, 0.8)';
                            }),
                            borderRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return 'Gelir: ' + context.parsed.y.toLocaleString('tr-TR') + ' ₺';
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: { color: 'rgba(0,0,0,0.05)' },
                                ticks: {
                                    callback: function(value) {
                                        return (value / 1000).toFixed(0) + 'k';
                                    }
                                }
                            },
                            x: {
                                grid: { display: false }
                            }
                        }
                    }
                });
            })
            .catch(err => console.error('Fiyat esneklik yüklenemedi:', err));
    } else if (tip === 'gecmis') {
        // Geçmiş fiyat trendi
        fetch('/api/fiyat-trend-oda-tipi')
            .then(response => response.json())
            .then(data => {
                const datasets = Object.keys(data.veriler || {}).map((tip, index) => {
                    const renkler = ['#3b82f6', '#10b981', '#f59e0b', '#ef4444'];
                    return {
                        label: tip,
                        data: data.veriler[tip] || [],
                        borderColor: renkler[index % renkler.length],
                        backgroundColor: renkler[index % renkler.length] + '40',
                        borderWidth: 2,
                        fill: false,
                        tension: 0.4
                    };
                });
                
                const labels = (data.aylar || []).map(ay => {
                    const [yil, ayNum] = ay.split('-');
                    const date = new Date(yil, ayNum - 1, 1);
                    return date.toLocaleDateString('tr-TR', { month: 'short', year: 'numeric' });
                });
                
                fiyatEsneklikChart = new Chart(ctx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: datasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'top' },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return context.dataset.label + ': ' + context.parsed.y.toLocaleString('tr-TR') + ' ₺';
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: { color: 'rgba(0,0,0,0.05)' },
                                ticks: {
                                    callback: function(value) {
                                        return (value / 1000).toFixed(0) + 'k';
                                    }
                                }
                            },
                            x: {
                                grid: { display: false }
                            }
                        }
                    }
                });
            })
            .catch(err => console.error('Fiyat trend yüklenemedi:', err));
    }
};

// Senaryo grafiği için chart değişkeni
let senaryoChart = null;

// Fiyat simülasyonu yapma
window.fiyatSimulasyonuYap = function() {
    const fiyatDegisimi = parseFloat(document.getElementById('fiyatDegisimiSlider').value) || 0;
    const personelSayisi = parseInt(document.getElementById('personelSayisiInput').value) || 20;
    const pazarlamaButcesi = parseFloat(document.getElementById('pazarlamaButcesiInput').value) || 0;
    
    fetch('/api/simulasyon', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            fiyatDegisimi: fiyatDegisimi,
            personelSayisi: personelSayisi,
            pazarlamaButcesi: pazarlamaButcesi,
            kampanyaTuru: 'google' // Varsayılan
        })
    })
    .then(response => response.json())
    .then(data => {
        // Senaryo verisini sakla (kaydetme için)
        window.sonSimulasyonVerisi = data;
        
        // KPI güncellemeleri
        const realistCiro = (data.realist && data.realist.ciro) || 0;
        const realistKar = (data.realist && data.realist.kar) || 0;
        const realistMarj = (data.realist && data.realist.marj) || 40;
        const mevcutKar = (data.mevcut && data.mevcut.kar) || 0;
        const karFark = realistKar - mevcutKar;
        
        if (document.getElementById('kpiCiro')) {
            document.getElementById('kpiCiro').textContent = realistCiro.toLocaleString('tr-TR') + ' ₺';
        }
        if (document.getElementById('kpiFark')) {
            document.getElementById('kpiFark').textContent = (karFark > 0 ? '+' : '') + karFark.toLocaleString('tr-TR') + ' ₺';
        }
        if (document.getElementById('kpiMarj')) {
            document.getElementById('kpiMarj').textContent = '%' + realistMarj.toFixed(1);
        }
        
        // KPI ve grafik bölümlerini göster
        if (document.getElementById('kpiRow')) {
            document.getElementById('kpiRow').style.display = 'flex';
        }
        if (document.getElementById('chartRow')) {
            document.getElementById('chartRow').style.display = 'flex';
        }
        if (document.getElementById('senaryoKaydetBtn')) {
            document.getElementById('senaryoKaydetBtn').style.display = 'inline-block';
        }
        
        // Senaryo grafiği çiz
        if (document.getElementById('senaryoGrafigi')) {
            const ctx = document.getElementById('senaryoGrafigi');
            if (senaryoChart) senaryoChart.destroy();
            
            const senaryoKarsilastirma = data.senaryoKarsilastirma || [];
            const labels = senaryoKarsilastirma.map(s => s.senaryo);
            const karData = senaryoKarsilastirma.map(s => s.kar);
            
            senaryoChart = new Chart(ctx.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Net Kâr (₺)',
                        data: karData,
                        backgroundColor: karData.map((kar, i) => {
                            if (labels[i] === 'İyimser') return '#10b981';
                            if (labels[i] === 'Gerçekçi') return '#3b82f6';
                            return '#ef4444';
                        }),
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'Kâr: ' + context.parsed.y.toLocaleString('tr-TR') + ' ₺';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: 'rgba(0,0,0,0.05)' },
                            ticks: {
                                callback: function(value) {
                                    return (value / 1000000).toFixed(1) + 'M';
                                }
                            }
                        },
                        x: {
                            grid: { display: false }
                        }
                    }
                }
            });
        }
    })
    .catch(err => {
        console.error('Simülasyon hatası:', err);
        alert('Simülasyon yapılırken bir hata oluştu: ' + err.message);
    });
};

// Senaryo kaydetme fonksiyonu
window.senaryoKaydet = function() {
    if (!window.sonSimulasyonVerisi) {
        alert('Önce simülasyon yapmanız gerekiyor!');
        return;
    }
    
    const data = window.sonSimulasyonVerisi;
    const fiyatDegisimi = parseFloat(document.getElementById('fiyatDegisimiSlider').value) || 0;
    const personelSayisi = parseInt(document.getElementById('personelSayisiInput').value) || 20;
    const pazarlamaButcesi = parseFloat(document.getElementById('pazarlamaButcesiInput').value) || 0;
    
    // Senaryo adı oluştur
    const tarih = new Date().toLocaleDateString('tr-TR');
    const senaryoAdi = `Simülasyon - Fiyat: %${fiyatDegisimi} - ${tarih}`;
    
    // Senaryo verisi hazırla
    const realistCiro = (data.realist && data.realist.ciro) || 0;
    const realistKar = (data.realist && data.realist.kar) || 0;
    const realistMarj = (data.realist && data.realist.marj) || 40;
    
    const senaryoVerisi = {
        senaryo_tipi: 'simulasyon',
        fiyat_degisimi: fiyatDegisimi,
        personel_sayisi: personelSayisi,
        pazarlama_butcesi: pazarlamaButcesi,
        tahmini_ciro: realistCiro,
        net_kar: realistKar,
        kar_marji: realistMarj,
        simulasyon_tarihi: new Date().toISOString(),
        senaryoKarsilastirma: data.senaryoKarsilastirma || []
    };
    
    fetch('/api/senaryo-kaydet', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            senaryo_adi: senaryoAdi,
            periyot: 6,
            senaryo_verisi: senaryoVerisi
        })
    })
    .then(response => response.json())
    .then(result => {
        if (result.success) {
            alert('Senaryo başarıyla kaydedildi!');
        } else {
            alert('Senaryo kaydedilirken bir hata oluştu: ' + (result.message || 'Bilinmeyen hata'));
        }
    })
    .catch(err => {
        console.error('Senaryo kaydetme hatası:', err);
        alert('Senaryo kaydedilirken bir hata oluştu: ' + err.message);
    });
};

// Dashboard verilerini yükle
window.refreshDashboard = function() {
    fetch('/api/dashboard/kpis')
        .then(response => response.json())
        .then(data => {
            // KPI değerlerini güncelle
            if (document.getElementById('kpiDoluluk')) {
                document.getElementById('kpiDoluluk').textContent = data.doluluk.toFixed(1) + '%';
            }
            if (document.getElementById('kpiGelir')) {
                document.getElementById('kpiGelir').textContent = (data.gelir / 1000000).toFixed(1) + 'M ₺';
            }
            if (document.getElementById('kpiKarMarji')) {
                document.getElementById('kpiKarMarji').textContent = data.karMarji.toFixed(1) + '%';
            }
            if (document.getElementById('kpiIptalOrani')) {
                document.getElementById('kpiIptalOrani').textContent = data.iptalOrani.toFixed(1) + '%';
            }
        })
        .catch(err => console.error('KPI verileri yüklenemedi:', err));
};

// KPI detay modalını aç
let kpiDetayChart = null;
window.kpiDetayAc = function(kpiTipi) {
    const modal = new bootstrap.Modal(document.getElementById('kpiDetayModal'));
    const baslik = document.getElementById('kpiDetayBaslik');
    
    const basliklar = {
        'doluluk': 'Doluluk Oranı Detay Analizi',
        'gelir': 'Gelir Detay Analizi',
        'karMarji': 'Kar Marjı Detay Analizi',
        'iptalOrani': 'İptal Oranı Detay Analizi'
    };
    
    baslik.textContent = basliklar[kpiTipi] || 'KPI Detay Analizi';
    modal.show();
    
    // Varsayılan olarak 6 ay yükle
    window.kpiDetayPeriyotDegistir(6);
};

// KPI detay periyot değiştirme
window.kpiDetayPeriyotDegistir = function(months) {
    // Buton durumlarını güncelle
    document.querySelectorAll('#kpiDetayPeriyot6, #kpiDetayPeriyot12').forEach(btn => {
        btn.classList.remove('active');
    });
    document.getElementById(`kpiDetayPeriyot${months}`).classList.add('active');
    
    // Grafik yükle
    fetch(`/api/kpi-detay?kpiTipi=doluluk&periyot=${months}`)
        .then(response => response.json())
        .then(data => {
            const ctx = document.getElementById('kpiDetayGrafigi');
            if (!ctx) return;
            
            if (kpiDetayChart) kpiDetayChart.destroy();
            
            kpiDetayChart = new Chart(ctx.getContext('2d'), {
                type: 'line',
                data: {
                    labels: data.labels || [],
                    datasets: [{
                        label: 'Değer',
                        data: data.values || [],
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: 'rgba(0,0,0,0.05)' }
                        },
                        x: {
                            grid: { display: false }
                        }
                    }
                }
            });
        })
        .catch(err => console.error('KPI detay yüklenemedi:', err));
};

// Doluluk grafiği yükleme
let dolulukChart = null;
window.dolulukGrafigiYukle = function() {
    fetch('/api/aylik-doluluk')
        .then(response => response.json())
        .then(data => {
            const ctx = document.getElementById('dolulukGrafigi');
            if (!ctx) return;
            
            if (dolulukChart) dolulukChart.destroy();
            
            const labels = data.map(d => d.ay);
            const values = data.map(d => d.rezervasyon_sayisi);
            
            dolulukChart = new Chart(ctx.getContext('2d'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Rezervasyon Sayısı',
                        data: values,
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: 'rgba(0,0,0,0.05)' }
                        },
                        x: {
                            grid: { display: false }
                        }
                    }
                }
            });
        })
        .catch(err => console.error('Doluluk grafiği yüklenemedi:', err));
};

// Rakip fiyat analizi yükleme - Oda bazında karşılaştırma
let rakipFiyatChart = null;
let rakipFiyatVerisi = null; // Modal için sakla
window.rakipFiyatAnaliziYukle = function() {
    const ctx = document.getElementById('rakipFiyatGrafigi');
    if (!ctx) return;
    
    if (rakipFiyatChart) rakipFiyatChart.destroy();
    
    fetch('/api/rakip-analizi')
        .then(response => response.json())
        .then(data => {
            rakipFiyatVerisi = data; // Modal için sakla
            
            // Oda tipleri
            const odaTipleri = ['Standart', 'Deluxe', 'Suit', 'Kral Dairesi'];
            const bizimFiyatlar = data.bizim_fiyatlar || {};
            
            // Bizim fiyatlar dataset'i
            const bizimFiyatData = odaTipleri.map(tip => bizimFiyatlar[tip] || 0);
            
            // İlk 3 rakibin ortalama fiyatları (oda bazında)
            const rakipler = data.properties || [];
            const ilk3Rakip = rakipler.slice(0, 3);
            
            const rakipOrtalamaFiyatlar = odaTipleri.map(odaTipi => {
                const fiyatlar = ilk3Rakip
                    .map(r => r.fiyat_karsilastirmalari && r.fiyat_karsilastirmalari[odaTipi] ? r.fiyat_karsilastirmalari[odaTipi].rakip_fiyat : null)
                    .filter(f => f !== null && f > 0);
                
                if (fiyatlar.length === 0) return 0;
                return fiyatlar.reduce((sum, f) => sum + f, 0) / fiyatlar.length;
            });
            
            // Pazar ortalaması (tüm rakiplerin ortalaması)
            const pazarOrtalamaFiyatlar = odaTipleri.map(odaTipi => {
                const fiyatlar = rakipler
                    .map(r => r.fiyat_karsilastirmalari && r.fiyat_karsilastirmalari[odaTipi] ? r.fiyat_karsilastirmalari[odaTipi].rakip_fiyat : null)
                    .filter(f => f !== null && f > 0);
                
                if (fiyatlar.length === 0) return 0;
                return fiyatlar.reduce((sum, f) => sum + f, 0) / fiyatlar.length;
            });
            
            rakipFiyatChart = new Chart(ctx.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: odaTipleri,
                    datasets: [
                        {
                            label: 'Bizim Fiyat',
                            data: bizimFiyatData,
                            backgroundColor: '#3b82f6',
                            borderRadius: 4
                        },
                        {
                            label: 'Rakip Ortalama',
                            data: pazarOrtalamaFiyatlar,
                            backgroundColor: '#ef4444',
                            borderRadius: 4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top' },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    const value = context.parsed.y;
                                    if (value < 100) {
                                        return context.dataset.label + ': ' + value.toFixed(2) + ' ₺';
                                    }
                                    return context.dataset.label + ': ' + value.toLocaleString('tr-TR') + ' ₺';
                                }
                            }
                        }
                    },
                    onHover: (event, activeElements) => {
                        event.native.target.style.cursor = activeElements.length > 0 ? 'pointer' : 'default';
                    },
                    scales: {
                        y: { 
                            beginAtZero: true,
                            grid: { color: 'rgba(0,0,0,0.05)' },
                            ticks: {
                                callback: function(value) {
                                    if (value < 1000) return value.toFixed(0) + ' ₺';
                                    return (value / 1000).toFixed(0) + 'k ₺';
                                }
                            }
                        },
                        x: {
                            grid: { display: false }
                        }
                    }
                }
            });
            
            // Chart.js v3 için onClick event handler
            ctx.onclick = function(event) {
                const points = rakipFiyatChart.getElementsAtEventForMode(event, 'nearest', { intersect: true }, true);
                if (points.length > 0) {
                    const firstPoint = points[0];
                    const odaTipi = odaTipleri[firstPoint.index];
                    window.rakipFiyatOdaDetayAc(odaTipi);
                }
            };
            
            // Pazar analizi bilgisini göster
            const pazarAnalizi = data.pazar_analizi || {};
            const pazarBilgi = document.getElementById('pazarAnaliziBilgi');
            if (pazarBilgi && pazarAnalizi.ortalama_fiyat) {
                pazarBilgi.innerHTML = `
                    <div class="alert alert-info mb-0 py-2">
                        <small>
                            <i class="fas fa-info-circle me-1"></i>
                            Pazar Ortalaması: ${Math.round(pazarAnalizi.ortalama_fiyat).toLocaleString('tr-TR')} ₺ | 
                            Toplam Otel: ${pazarAnalizi.toplam_otel_sayisi || rakipler.length} | 
                            Pozisyonumuz: <span class="fw-bold">${pazarAnalizi.bizim_pazar_pozisyonu || 'orta'}</span>
                        </small>
                    </div>
                `;
            }
        })
        .catch(err => {
            console.error('Rakip fiyat verileri yüklenemedi:', err);
            // Fallback: Mock data göster
            fetch('/api/competitor-prices')
                .then(response => response.json())
                .then(data => {
                    rakipFiyatChart = new Chart(ctx.getContext('2d'), {
                        type: 'bar',
                        data: data,
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { position: 'top' },
                                tooltip: {
                                    mode: 'index',
                                    intersect: false,
                                    callbacks: {
                                        label: function(context) {
                                            return context.dataset.label + ': ' + context.parsed.y.toLocaleString('tr-TR') + ' ₺';
                                        }
                                    }
                                }
                            },
                            scales: {
                                y: { 
                                    beginAtZero: true,
                                    grid: { color: 'rgba(0,0,0,0.05)' }
                                },
                                x: {
                                    grid: { display: false }
                                }
                            }
                        }
                    });
                });
        });
};

// Oda bazında detaylı rakip fiyat karşılaştırması modal'ı
let rakipOdaDetayChart = null;
window.rakipFiyatOdaDetayAc = function(odaTipi) {
    if (!rakipFiyatVerisi) {
        alert('Önce rakip fiyat analizi yüklenmesi gerekiyor!');
        return;
    }
    
    const modal = new bootstrap.Modal(document.getElementById('odaDetayModal'));
    const baslik = document.getElementById('modalOdaBaslik');
    const dRakip = document.getElementById('bolumRakip');
    const dGrafik = document.getElementById('bolumGrafik');
    
    // Sadece rakip karşılaştırması bölümünü göster
    dGrafik.classList.add('d-none');
    dRakip.classList.remove('d-none');
    
    baslik.innerHTML = `<i class="fas fa-balance-scale text-warning me-2"></i> ${odaTipi} - Rakip Fiyat Karşılaştırması`;
    
    const rakipler = rakipFiyatVerisi.properties || [];
    const bizimFiyat = rakipFiyatVerisi.bizim_fiyatlar && rakipFiyatVerisi.bizim_fiyatlar[odaTipi] ? rakipFiyatVerisi.bizim_fiyatlar[odaTipi] : 0;
    
    // Rakip listesi tablosunu doldur
    const liste = document.getElementById('modalRakipListesi');
    liste.innerHTML = '';
    
    rakipler.slice(0, 10).forEach(r => {
        const karsilastirma = r.fiyat_karsilastirmalari && r.fiyat_karsilastirmalari[odaTipi];
        if (!karsilastirma) return;
        
        const rakipFiyat = karsilastirma.rakip_fiyat || 0;
        const fark = karsilastirma.fark || 0;
        const farkYuzde = karsilastirma.fark_yuzde || 0;
        const durum = karsilastirma.rekabet_durumu || 'orta';
        
        let durumBadge = '';
        if (durum === 'ucuz') {
            durumBadge = '<span class="badge bg-danger bg-opacity-10 text-danger">Pahalı</span>';
        } else if (durum === 'pahali') {
            durumBadge = '<span class="badge bg-success bg-opacity-10 text-success">Uygun</span>';
        } else {
            durumBadge = '<span class="badge bg-warning bg-opacity-10 text-warning">Orta</span>';
        }
        
        liste.innerHTML += `
            <tr>
                <td>
                    <div class="fw-bold">${r.otel_adi}</div>
                    <small class="text-muted">
                        ${r.rating ? '⭐ ' + r.rating : ''} 
                        ${r.review_count ? '(' + r.review_count.toLocaleString('tr-TR') + ' değerlendirme)' : ''}
                    </small>
                </td>
                <td class="text-end fw-bold">${rakipFiyat.toLocaleString('tr-TR')} ₺</td>
                <td class="text-end">
                    ${farkYuzde !== 0 ? (farkYuzde > 0 ? '+' : '') + farkYuzde.toFixed(1) + '%' : '-'}
                </td>
                <td class="text-end">${durumBadge}</td>
            </tr>
        `;
    });
    
    // Grafik çiz
    const ctx2 = document.getElementById('rakipGrafigiAnalytics');
    if (ctx2) {
        if (rakipOdaDetayChart) rakipOdaDetayChart.destroy();
        
        const labels = ['Bizim Otel', ...rakipler.slice(0, 8).map(r => r.otel_adi.split(' ')[0])];
        const values = [bizimFiyat, ...rakipler.slice(0, 8).map(r => {
            const karsilastirma = r.fiyat_karsilastirmalari && r.fiyat_karsilastirmalari[odaTipi];
            return karsilastirma ? karsilastirma.rakip_fiyat : 0;
        })];
        const renkler = ['#3b82f6', ...values.slice(1).map(v => v > bizimFiyat ? '#ef4444' : '#10b981')];
        
        rakipOdaDetayChart = new Chart(ctx2.getContext('2d'), {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: `${odaTipi} Fiyatı (₺)`,
                    data: values,
                    backgroundColor: renkler,
                    borderRadius: 6
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.parsed.y.toLocaleString('tr-TR') + ' ₺';
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: { color: 'rgba(0,0,0,0.05)' },
                        ticks: {
                            callback: function(value) {
                                if (value < 1000) return value.toFixed(0) + ' ₺';
                                return (value / 1000).toFixed(0) + 'k ₺';
                            }
                        }
                    },
                    x: {
                        grid: { display: false },
                        ticks: {
                            maxRotation: 45,
                            minRotation: 45
                        }
                    }
                }
            }
        });
    }
    
    modal.show();
};

// Yıllık karşılaştırma yükleme
let yillikKarsilastirmaChart = null;
window.yillikKarsilastirmaYukle = function() {
    fetch('/api/dashboard/yillik-karsilastirma')
        .then(response => response.json())
        .then(data => {
            const ctx = document.getElementById('yillikKarsilastirmaChart');
            if (!ctx) return;
            
            if (yillikKarsilastirmaChart) yillikKarsilastirmaChart.destroy();
            
            const yillikVeriler = data.yillik_veriler || [];
            const labels = yillikVeriler.map(v => v.yil);
            const gelirData = yillikVeriler.map(v => v.toplam_gelir);
            const karData = yillikVeriler.map(v => v.toplam_kar);
            
            yillikKarsilastirmaChart = new Chart(ctx.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Gelir (₺)',
                            data: gelirData,
                            backgroundColor: '#3b82f6',
                            borderRadius: 4,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Kâr (₺)',
                            data: karData,
                            backgroundColor: '#10b981',
                            borderRadius: 4,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top' },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.parsed.y.toLocaleString('tr-TR') + ' ₺';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            beginAtZero: true,
                            grid: { color: 'rgba(0,0,0,0.05)' },
                            ticks: {
                                callback: function(value) {
                                    return (value / 1000000).toFixed(0) + 'M';
                                }
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            beginAtZero: true,
                            grid: { drawOnChartArea: false },
                            ticks: {
                                callback: function(value) {
                                    return (value / 1000000).toFixed(0) + 'M';
                                }
                            }
                        },
                        x: {
                            grid: { display: false }
                        }
                    }
                }
            });
        })
        .catch(err => console.error('Yıllık karşılaştırma yüklenemedi:', err));
};

// Personel İhtiyacı Tahmini yükleme
let personelIhtiyaciChart = null;
window.personelIhtiyaciYukle = function() {
    fetch('/api/personel-ihtiyaci')
        .then(response => response.json())
        .then(data => {
            const ctx = document.getElementById('personelIhtiyaciGrafigi');
            if (!ctx) return;
            
            if (personelIhtiyaciChart) personelIhtiyaciChart.destroy();
            
            const grafikData = data.doluluk_personel_grafik || [];
            const labels = grafikData.map(d => d.doluluk_orani + '%');
            const toplamData = grafikData.map(d => d.personel_ihtiyaci.toplam);
            
            personelIhtiyaciChart = new Chart(ctx.getContext('2d'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Toplam Personel İhtiyacı',
                        data: toplamData,
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'Personel: ' + context.parsed.y + ' kişi';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: 'rgba(0,0,0,0.05)' }
                        },
                        x: {
                            grid: { display: false }
                        }
                    }
                }
            });
        })
        .catch(err => console.error('Personel ihtiyacı yüklenemedi:', err));
};

// Gelir Trend Analizi yükleme
let gelirTrendChart = null;
window.gelirTrendYukle = function() {
    fetch('/api/gelir-trend')
        .then(response => response.json())
        .then(data => {
            const ctx = document.getElementById('gelirTrendGrafigi');
            if (!ctx) return;
            
            if (gelirTrendChart) gelirTrendChart.destroy();
            
            const labels = data.map(d => {
                const [yil, ay] = d.ay.split('-');
                const date = new Date(yil, ay - 1, 1);
                return date.toLocaleDateString('tr-TR', { month: 'short', year: 'numeric' });
            });
            const gelirData = data.map(d => d.toplam_gelir);
            const rezervasyonData = data.map(d => d.rezervasyon_sayisi);
            
            gelirTrendChart = new Chart(ctx.getContext('2d'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Gelir (₺)',
                            data: gelirData,
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Rezervasyon Sayısı',
                            data: rezervasyonData,
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top' },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    if (context.datasetIndex === 0) {
                                        return 'Gelir: ' + context.parsed.y.toLocaleString('tr-TR') + ' ₺';
                                    } else {
                                        return 'Rezervasyon: ' + context.parsed.y;
                                    }
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            beginAtZero: true,
                            grid: { color: 'rgba(0,0,0,0.05)' },
                            ticks: {
                                callback: function(value) {
                                    return (value / 1000).toFixed(0) + 'k';
                                }
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            beginAtZero: true,
                            grid: { drawOnChartArea: false }
                        },
                        x: {
                            grid: { display: false }
                        }
                    }
                }
            });
        })
        .catch(err => console.error('Gelir trend yüklenemedi:', err));
};

// Tahmin Doğruluğu yükleme
let tahminDogruluguChart = null;
window.tahminDogruluguYukle = function() {
    fetch('/api/tahmin-dogrulugu')
        .then(response => response.json())
        .then(data => {
            const ctx = document.getElementById('tahminDogruluguGrafigi');
            if (!ctx) return;
            
            if (tahminDogruluguChart) tahminDogruluguChart.destroy();
            
            const labels = data.map(d => {
                const [yil, ay] = d.ay.split('-');
                const date = new Date(yil, ay - 1, 1);
                return date.toLocaleDateString('tr-TR', { month: 'short', year: 'numeric' });
            });
            const gercekData = data.map(d => d.gercek_rezervasyon);
            const tahminData = data.map(d => d.tahmin_rezervasyon);
            
            tahminDogruluguChart = new Chart(ctx.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Gerçek',
                            data: gercekData,
                            backgroundColor: '#10b981',
                            borderRadius: 4
                        },
                        {
                            label: 'Tahmin',
                            data: tahminData,
                            backgroundColor: '#3b82f6',
                            borderRadius: 4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top' },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.parsed.y + ' rezervasyon';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: 'rgba(0,0,0,0.05)' }
                        },
                        x: {
                            grid: { display: false }
                        }
                    }
                }
            });
        })
        .catch(err => console.error('Tahmin doğruluğu yüklenemedi:', err));
};

// Sayfa yüklendiğinde varsayılan grafikleri yükle
document.addEventListener('DOMContentLoaded', function() {
    // KPI verilerini yükle
    window.refreshDashboard();
    
    // Doluluk grafiğini yükle
    if (document.getElementById('dolulukGrafigi')) {
        window.dolulukGrafigiYukle();
    }
    
    // Rakip fiyat grafiğini yükle
    if (document.getElementById('rakipFiyatGrafigi')) {
        window.rakipFiyatAnaliziYukle();
    }
    
    // Varsayılan olarak 6 aylık tahminleri yükle
    if (document.getElementById('dolulukTahminiGrafigi')) {
        window.dolulukTahminiPeriyotDegistir(6, document.getElementById('dolulukTahminiBtn6'));
    }
    if (document.getElementById('gelirKarTahminiGrafigi')) {
        window.gelirKarTahminiPeriyotDegistir(6, document.getElementById('gelirKarTahminiBtn6'));
    }
    
    // Yıllık karşılaştırma grafiğini yükle
    if (document.getElementById('yillikKarsilastirmaChart')) {
        window.yillikKarsilastirmaYukle();
    }
    
    // Personel ihtiyacı grafiğini yükle
    if (document.getElementById('personelIhtiyaciGrafigi')) {
        window.personelIhtiyaciYukle();
    }
    
    // Gelir trend grafiğini yükle
    if (document.getElementById('gelirTrendGrafigi')) {
        window.gelirTrendYukle();
    }
    
    // Tahmin doğruluğu grafiğini yükle
    if (document.getElementById('tahminDogruluguGrafigi')) {
        window.tahminDogruluguYukle();
    }
    
    // Varsayılan doluluk ve fiyat grafiklerini yükle (sadece sayfa görünürse)
    setTimeout(() => {
        if (document.getElementById('dolulukOraniGrafigi')) {
            const dolulukBtn = document.querySelector('.btn[onclick*="dolulukGrafigiDegistir(\'gecmis\'"]');
            if (dolulukBtn) window.dolulukGrafigiDegistir('gecmis', dolulukBtn);
        }
        if (document.getElementById('fiyatEsneklikGrafigi')) {
            const fiyatBtn = document.querySelector('.btn[onclick*="fiyatGrafigiDegistir(\'analiz\'"]');
            if (fiyatBtn) window.fiyatGrafigiDegistir('analiz', fiyatBtn);
        }
    }, 100);
});
</script>
</body>
</html>