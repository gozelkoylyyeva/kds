<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HotelVision - Otel Karar Destek Sistemi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.1.0/dist/chartjs-plugin-datalabels.min.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="/views/style.css">
</head>
<body>
<div class="container-fluid">
    <div class="row">
        <div class="col-md-2 sidebar p-0 d-flex flex-column" style="min-height: 100vh;">
            <div class="text-center py-5 mb-4 px-3 border-bottom border-secondary">
                <div class="d-flex align-items-center justify-content-center mb-3">
                    <div class="position-relative">
                        <div class="kpi-icon text-primary" style="width: 56px; height: 56px; margin-bottom: 0; background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(139, 92, 246, 0.2)); box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);">
                        <i class="fas fa-hotel"></i>
                        </div>
                        <div class="position-absolute top-0 start-100 translate-middle">
                            <span class="badge bg-success rounded-pill" style="font-size: 0.6rem; padding: 2px 6px;">
                                <i class="fas fa-circle" style="font-size: 0.4rem;"></i>
                            </span>
                        </div>
                    </div>
                </div>
                <div class="text-start px-2">
                    <div class="fw-bold fs-5 text-primary m-0 mb-1" style="letter-spacing: -0.5px;">HotelVision</div>
                    <small class="text-muted d-block mb-2" style="font-size: 0.7rem; font-weight: 500;">Karar Destek Platformu</small>
                    <div class="badge bg-gradient text-white px-3 py-1" style="font-size: 0.7rem; font-weight: 600; border-radius: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                        <i class="fas fa-chart-line me-1"></i>Akıllı Analiz
                    </div>
                </div>
            </div>
            
            <div class="px-2 flex-grow-1">
                <a onclick="window.sayfaDegistir('sayfa-ozet', this)" class="menu-link active">
                    <i class="fas fa-chart-pie"></i>
                    <span>Genel Bakış</span>
                </a>
                <a onclick="window.sayfaDegistir('sayfa-simulasyon', this)" class="menu-link">
                    <i class="fas fa-brain"></i>
                    <span>Strateji Simülatörü</span>
                </a>
            </div>
            
        </div>

        <div class="col-md-10 content-area p-4">
            
            <div id="sayfa-ozet" class="page-section active">
                <!-- Dashboard Header - Power BI/Excel Style -->
                <div class="d-flex justify-content-between align-items-center mb-4 pb-3 border-bottom" style="border-color: #e2e8f0 !important;">
                    <div>
                        <h1 class="page-title m-0 fw-bold" style="font-size: 1.75rem; color: #1e293b;">
                            <i class="fas fa-chart-line me-3" style="color: #3b82f6;"></i>Genel Durum Özeti
                        </h1>
                    </div>
                    <div class="d-flex gap-2">
                        <button class="btn btn-outline-secondary btn-sm" onclick="refreshDashboard()" title="Yenile">
                            <i class="fas fa-sync-alt me-1"></i>Yenile
                        </button>
                    </div>
                </div>
                
                
                <!-- KPI Kartları - Power BI/Excel Style -->
                <div class="row g-4 mb-4" id="gelismisKPI">
                    <div class="col-lg-3 col-md-6">
                        <div class="card kpi-card border-primary shadow-sm border-0 p-4" style="cursor: pointer; transition: transform 0.2s;" onclick="kpiDetayAc('doluluk')" onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'">
                            <div class="d-flex align-items-center justify-content-between mb-3">
                                <div class="kpi-icon text-primary">
                                    <i class="fas fa-bed"></i>
                                </div>
                                <div class="text-end">
                                    <small class="text-muted d-block mb-1 fw-semibold">Doluluk Oranı</small>
                                    <h2 class="kpi-value m-0 fw-bold" id="kpiDoluluk">-</h2>
                                </div>
                            </div>
                            <div class="d-flex align-items-center mb-2" id="kpiDolulukDegisim">
                                <i class="fas fa-arrow-up me-2 text-success"></i>
                                <span class="small">-</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6">
                        <div class="card kpi-card border-success shadow-sm border-0 p-4" style="cursor: pointer; transition: transform 0.2s;" onclick="kpiDetayAc('gelir')" onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'">
                            <div class="d-flex align-items-center justify-content-between mb-3">
                                <div class="kpi-icon text-success">
                                    <i class="fas fa-lira-sign"></i>
                                </div>
                                <div class="text-end">
                                    <small class="text-muted d-block mb-1 fw-semibold">Toplam Gelir</small>
                                    <h2 class="kpi-value m-0 fw-bold" id="kpiGelir">-</h2>
                                </div>
                            </div>
                            <div class="d-flex align-items-center mb-2" id="kpiGelirDegisim">
                                <i class="fas fa-arrow-up me-2 text-success"></i>
                                <span class="small">-</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6">
                        <div class="card kpi-card border-warning shadow-sm border-0 p-4" style="cursor: pointer; transition: transform 0.2s;" onclick="kpiDetayAc('karMarji')" onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'">
                            <div class="d-flex align-items-center justify-content-between mb-3">
                                <div class="kpi-icon text-warning">
                                    <i class="fas fa-chart-pie"></i>
                                </div>
                                <div class="text-end">
                                    <small class="text-muted d-block mb-1 fw-semibold">Kar Marjı</small>
                                    <h2 class="kpi-value m-0 fw-bold" id="kpiKarMarji">-</h2>
                                </div>
                            </div>
                            <div class="d-flex align-items-center mb-2" id="kpiKarMarjiDegisim">
                                <i class="fas fa-arrow-up me-2 text-success"></i>
                                <span class="small">-</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6">
                        <div class="card kpi-card border-danger shadow-sm border-0 p-4" style="cursor: pointer; transition: transform 0.2s;" onclick="kpiDetayAc('iptalOrani')" onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'">
                            <div class="d-flex align-items-center justify-content-between mb-3">
                                <div class="kpi-icon text-danger">
                                    <i class="fas fa-times-circle"></i>
                                </div>
                                <div class="text-end">
                                    <small class="text-muted d-block mb-1 fw-semibold">İptal Oranı</small>
                                    <h2 class="kpi-value m-0 fw-bold" id="kpiIptalOrani">-</h2>
                                </div>
                            </div>
                            <div class="d-flex align-items-center mb-2" id="kpiIptalOraniDegisim">
                                <i class="fas fa-arrow-down me-2 text-danger"></i>
                                <span class="small">-</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Aylık Rezervasyon Trendi ve Rakip Fiyat Analizi - Yan Yana -->
                <div class="row g-4 mb-4">
                    <div class="col-lg-6">
                        <div class="card shadow-sm border-0 p-4 h-100">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h5 class="mb-0 fw-bold"><i class="fas fa-chart-area me-2 text-primary"></i>Aylık Rezervasyon Trendi</h5>
                            </div>
                            <div style="height:450px; position:relative;">
                                <canvas id="dolulukGrafigi"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="card shadow-sm border-0 p-4 border-warning border-start border-4 h-100">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h5 class="mb-0 fw-bold"><i class="fas fa-balance-scale me-2 text-warning"></i>Rakip Fiyat Analizi</h5>
                                <button class="btn btn-sm btn-outline-warning" onclick="rakipFiyatAnaliziYukle()">
                                    <i class="fas fa-sync-alt me-1"></i>Yenile
                                </button>
                            </div>
                            <div id="pazarAnaliziBilgi"></div>
                            <div id="rakipFiyatListesi" style="height:450px; position:relative;">
                                <canvas id="rakipFiyatGrafigi"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                    <!-- Gelecek Tahminleri ve Stratejiler -->
                <div class="row g-4 mt-4">
                    
                    <!-- Doluluk Tahmini ve Gelir-Kâr Tahmini - Yan Yana -->
                    <div class="col-lg-6">
                        <div class="card shadow-sm border-0 p-4 border-primary border-start border-4 h-100">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h5 class="mb-0 fw-bold"><i class="fas fa-calendar-alt me-2 text-primary"></i>Doluluk Tahmini</h5>
                                <div class="btn-group btn-group-sm">
                                    <button class="btn btn-outline-primary active" onclick="dolulukTahminiPeriyotDegistir(6, this)" id="dolulukTahminiBtn6">6 Ay</button>
                                    <button class="btn btn-outline-primary" onclick="dolulukTahminiPeriyotDegistir(12, this)" id="dolulukTahminiBtn12">12 Ay</button>
                                </div>
                            </div>
                            <div id="dolulukTahminiListesi" style="height:450px; position:relative;">
                                <canvas id="dolulukTahminiGrafigi"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-6">
                        <div class="card shadow-sm border-0 p-4 border-success border-start border-4 h-100">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h5 class="mb-0 fw-bold"><i class="fas fa-chart-line me-2 text-success"></i>Gelir ve Kâr Tahmini</h5>
                                <div class="btn-group btn-group-sm">
                                    <button class="btn btn-outline-success active" onclick="gelirKarTahminiPeriyotDegistir(6, this)" id="gelirKarTahminiBtn6">6 Ay</button>
                                    <button class="btn btn-outline-success" onclick="gelirKarTahminiPeriyotDegistir(12, this)" id="gelirKarTahminiBtn12">12 Ay</button>
                                </div>
                            </div>
                            <div id="gelirKarTahminiListesi" style="height:450px; position:relative;">
                                <canvas id="gelirKarTahminiGrafigi"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Yıllık Karşılaştırma ve Personel İhtiyacı - Yan Yana -->
                    <div class="col-lg-6">
                        <div class="card shadow-sm border-0 p-4 border-info border-start border-4 h-100">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h5 class="mb-0 fw-bold"><i class="fas fa-calendar-check me-2 text-info"></i>Yıllık Karşılaştırma</h5>
                                <button class="btn btn-sm btn-outline-info" onclick="yillikKarsilastirmaYukle()">
                                    <i class="fas fa-sync-alt me-1"></i>Yenile
                                </button>
                            </div>
                            <div id="yillikKarsilastirmaBilgi" class="mb-3"></div>
                            <div id="yillikKarsilastirmaTablosu" class="table-responsive mb-3" style="max-height: 180px; overflow-y: auto;"></div>
                            <div id="yillikKarsilastirmaGrafigi" style="height:380px; position:relative;">
                                <canvas id="yillikKarsilastirmaChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-6">
                        <div class="card shadow-sm border-0 p-4 border-info border-start border-4 h-100">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h5 class="mb-0 fw-bold"><i class="fas fa-users me-2 text-info"></i>Personel İhtiyacı Tahmini</h5>
                            </div>
                            <div class="row g-4">
                                <div class="col-12">
                                    <div id="personelIhtiyaciListesi" class="table-responsive mb-3">
                                        <table class="table table-sm table-hover">
                                            <thead class="table-light">
                                                <tr>
                                                    <th>Departman</th>
                                                    <th>Mevcut</th>
                                                    <th>Önerilen</th>
                                                    <th>Fark</th>
                                                </tr>
                                            </thead>
                                            <tbody id="personelIhtiyaciTablosu">
                                                <tr><td colspan="4" class="text-center text-muted"></td></tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div style="height:400px; position:relative;">
                                        <canvas id="personelIhtiyaciGrafigi"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                </div>
            </div>

            <div id="sayfa-simulasyon" class="page-section">
                <!-- Başlık -->
                <div class="mb-4">
                    <h1 class="page-title m-0"><i class="fas fa-brain me-3 text-primary"></i>Strateji Simülatörü</h1>
                </div>
                
                <!-- Kontroller - Üstte Yan Yana -->
                <div class="row g-3 mb-4">
                    <div class="col-md-4">
                        <div class="card p-4 border-start border-4 border-primary shadow-sm">
                            <h6 class="text-primary fw-bold mb-3 text-uppercase"><i class="fas fa-tag me-2"></i>Fiyat Politikası</h6>
                            <label for="fiyatDegisimiSlider" class="text-muted small mb-2 d-flex justify-content-between">Fiyat Değişimi <span id="fiyatDegisimiLabel" class="fw-bold text-primary">0%</span></label>
                            <input type="range" class="form-range" min="-50" max="50" step="1" value="0" id="fiyatDegisimiSlider">
                            <div class="input-group mt-2">
                                <input type="number" id="fiyatDegisimiInput" class="form-control form-control-sm fw-bold text-center" value="0" min="-50" max="50">
                                <span class="input-group-text bg-light border-secondary"><i class="fas fa-percent"></i></span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card p-4 border-start border-4 border-info shadow-sm">
                            <h6 class="text-info fw-bold mb-3 text-uppercase"><i class="fas fa-users me-2"></i>Personel Sayısı</h6>
                            <label for="personelSayisiInput" class="text-muted small mb-2 d-block">Personel Sayısı</label>
                            <div class="input-group">
                                <input type="number" id="personelSayisiInput" class="form-control fw-bold text-center" value="20" placeholder="Örn: 25, 30, 50" style="font-size: 1.1rem; padding: 12px;" step="1" inputmode="numeric" pattern="[0-9]*">
                                <span class="input-group-text bg-light border-secondary"><i class="fas fa-user"></i></span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card p-4 border-start border-4 border-warning shadow-sm">
                            <h6 class="text-warning fw-bold mb-3 text-uppercase"><i class="fas fa-bullhorn me-2"></i>Pazarlama Bütçesi</h6>
                            <label for="pazarlamaButcesiInput" class="text-muted small mb-2 d-block">Aylık Bütçe (₺)</label>
                            <div class="input-group">
                                <input type="number" id="pazarlamaButcesiInput" class="form-control fw-bold text-center" value="0" placeholder="Pazarlama bütçesini girin" style="font-size: 1.1rem; padding: 12px;">
                                <span class="input-group-text bg-light border-secondary">₺</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Simüle Et ve Senaryo Kaydet Butonları -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="d-flex gap-3">
                            <button class="btn btn-primary btn-lg px-5 fw-bold shadow-lg" onclick="window.fiyatSimulasyonuYap()">
                                <i class="fas fa-rocket me-2"></i>SİMÜLE ET
                            </button>
                            <button class="btn btn-success btn-lg px-5 fw-bold shadow-lg" onclick="window.senaryoKaydet()" id="senaryoKaydetBtn" style="display:none;">
                                <i class="fas fa-save me-2"></i>SENARYOYU KAYDET
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Grafikler ve Analizler - Altta -->
                <div class="row">
                    <div class="col-12">
                        <div class="row g-3 mb-3" id="kpiRow" style="display:none;">
                            <div class="col-md-4"><div class="card p-3 text-center border-bottom border-4 border-info"><small class="text-muted text-uppercase fw-bold">Tahmini Ciro</small><h3 class="text-white fw-bold m-0" id="kpiCiro">0 ₺</h3></div></div>
                            <div class="col-md-4"><div class="card p-3 text-center border-bottom border-4" id="kpiKarCard"><small class="text-muted text-uppercase fw-bold">Net Kâr Farkı</small><h3 class="text-white fw-bold m-0" id="kpiFark">0 ₺</h3></div></div>
                            <div class="col-md-4"><div class="card p-3 text-center border-bottom border-4 border-warning"><small class="text-muted text-uppercase fw-bold">Yeni Kâr Marjı</small><h3 class="text-white fw-bold m-0" id="kpiMarj">%0</h3></div></div>
                        </div>
                        <div class="row g-3" id="chartRow" style="display:none;">
                            <div class="col-md-12 mb-3"><div class="card p-4"><h6 class="text-muted mb-3 text-uppercase fw-bold"><i class="fas fa-chart-bar me-2"></i>Senaryo Karşılaştırması - Net Kâr Analizi</h6><div style="height:350px"><canvas id="senaryoGrafigi"></canvas></div></div></div>
                            <div class="col-md-6" id="ciroGrafikKolon" style="display:none;"><div class="card p-4"><h6 class="text-muted mb-3 text-uppercase fw-bold"><i class="fas fa-chart-line me-2"></i>Ciro Karşılaştırması</h6><div style="height:250px"><canvas id="ciroGrafigi"></canvas></div></div></div>
                        </div>
                        <!-- Senaryo Karşılaştırma Tablosu -->
                        <div class="row mt-4" id="senaryoKarsilastirmaRow" style="display:none;">
                            <div class="col-12">
                                <div class="card p-4 border-success border-start border-4">
                                    <h6 class="mb-3"><i class="fas fa-table me-2"></i>Senaryo Karşılaştırması</h6>
                                    <div class="table-responsive">
                                        <table class="table table-sm table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Senaryo</th>
                                                    <th>Beklenen Gelir</th>
                                                    <th>Net Kâr</th>
                                                    <th>Risk Seviyesi</th>
                                                    <th>Değerlendirilebilir mi?</th>
                                                    <th>Analiz Yorumu</th>
                                                </tr>
                                            </thead>
                                            <tbody id="senaryoKarsilastirmaTablosu">
                                                <tr><td colspan="6" class="text-center text-muted">Simülasyon yapıldığında görünecek</td></tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Detaylı Analiz ve Grafikler -->
                        <div class="row g-4 mt-4">
                            <div class="col-12">
                                <h4 class="mb-4"><i class="fas fa-chart-line me-2 text-primary"></i>Detaylı Analiz ve Grafikler</h4>
                            </div>
                            
                            <!-- Gelir Trend Analizi ve Tahmin Doğruluğu - Yan Yana -->
                            <div class="col-lg-6">
                                <div class="card p-4 h-100">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <div>
                                            <h5 class="mb-1"><i class="fas fa-chart-line me-2 text-primary"></i>Gelir Trend Analizi</h5>
                                            <small class="text-muted">Aylık gelir ve rezervasyon trendi</small>
                                        </div>
                                    </div>
                                    <div style="height:350px; position:relative;">
                                        <canvas id="gelirTrendGrafigi"></canvas>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="card p-4 h-100">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <div>
                                            <h5 class="mb-1"><i class="fas fa-bullseye me-2 text-info"></i>Tahmin Doğruluğu</h5>
                                            <small class="text-muted">Gerçek vs tahmin karşılaştırması</small>
                                        </div>
                                    </div>
                                    <div style="height:350px; position:relative;">
                                        <canvas id="tahminDogruluguGrafigi"></canvas>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Doluluk Analizi ve Fiyat Analizi - Yan Yana -->
                            <div class="col-lg-6">
                                <div class="card p-4 h-100" style="overflow:visible;">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <div>
                                            <h5 class="mb-1"><i class="fas fa-chart-bar me-2 text-success"></i>Doluluk Analizi</h5>
                                            <small class="text-muted">Geçmiş ve Gelecek Performans</small>
                                        </div>
                                        <div class="btn-group btn-group-sm">
                                            <button class="btn btn-outline-success active" onclick="dolulukGrafigiDegistir('gecmis', this)">Geçmiş</button>
                                            <button class="btn btn-outline-success" onclick="dolulukGrafigiDegistir('tahmin-6', this)">Tahmin 6A</button>
                                            <button class="btn btn-outline-success" onclick="dolulukGrafigiDegistir('tahmin-12', this)">Tahmin 12A</button>
                                        </div>
                                    </div>
                                    <div style="height:450px; position:relative; overflow:visible; min-height:450px;">
                                        <canvas id="dolulukOraniGrafigi"></canvas>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="card p-4 h-100">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <div>
                                            <h5 class="mb-1"><i class="fas fa-balance-scale me-2 text-primary"></i>Fiyat Analizi</h5>
                                            <small class="text-muted">Esneklik ve Trendler</small>
                                        </div>
                                        <div class="btn-group btn-group-sm">
                                            <button class="btn btn-outline-primary active" onclick="fiyatGrafigiDegistir('analiz', this)">Esneklik Analizi</button>
                                            <button class="btn btn-outline-primary" onclick="fiyatGrafigiDegistir('gecmis', this)">Geçmiş Trend</button>
                                        </div>
                                    </div>
                                    <div style="height:450px; position:relative;">
                                        <canvas id="fiyatEsneklikGrafigi"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mt-4">
                            <div class="col-12">
                                <div class="card p-4">
                                    <h6 class="mb-3"><i class="fas fa-history me-2"></i>Kaydedilen Senaryolar</h6>
                                    <div class="table-responsive">
                                        <table class="table table-sm table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Tarih</th>
                                                    <th>Senaryo Adı</th>
                                                    <th>Tip</th>
                                                    <th>Tahmini Kâr</th>
                                                    <th>Durum</th>
                                                    <th>İşlemler</th>
                                                </tr>
                                            </thead>
                                            <tbody id="senaryoListesi">
                                                <tr><td colspan="5" class="text-center text-muted">Henüz senaryo kaydedilmedi</td></tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
                </div>
            </div>


                            </div>
                            </div>
                        </div>

<div class="modal fade" id="dovizModal" tabindex="-1"><div class="modal-dialog modal-lg modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="dovizModalBaslik"></h5><button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button></div><div class="modal-body"><div style="height:350px"><canvas id="dovizDetayGrafigi"></canvas></div></div></div></div>    </div>

    <!-- KPI Detay Modal -->
    <div class="modal fade" id="kpiDetayModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content shadow-lg">
                <div class="modal-header">
                    <h5 class="modal-title fw-bold" id="kpiDetayBaslik">KPI Detay Analizi</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div>
                            <small class="text-muted">Periyot Seçimi</small>
                        </div>
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-outline-primary" onclick="kpiDetayPeriyotDegistir(6)" id="kpiDetayPeriyot6">6 Ay</button>
                            <button class="btn btn-outline-primary" onclick="kpiDetayPeriyotDegistir(12)" id="kpiDetayPeriyot12">12 Ay</button>
                        </div>
                    </div>
                    <div style="height: 400px;">
                        <canvas id="kpiDetayGrafigi"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Premium Analytics Modal -->
    <div class="modal fade" id="odaDetayModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-xl">
            <div class="modal-content shadow-lg">
                <div class="modal-header">
                    <div><h5 class="modal-title fw-bold" id="modalOdaBaslik">Detay Analizi</h5><small class="text-muted">Kaynak: Booking DB & Google Hotels API</small></div>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4">
                    <div id="bolumGrafik" class="d-none animate-fade">
                        <div class="d-flex align-items-center mb-4"><div class="p-2 bg-info bg-opacity-10 rounded me-3"><i class="fas fa-history text-info"></i></div><h6 class="m-0 text-info">Fiyat Geçmişi (2023-2025)</h6></div>
                        <div class="p-3 rounded-4 bg-light border"><div style="height: 400px;"><canvas id="detayGrafigi"></canvas></div></div>
                    </div>
                    <div id="bolumRakip" class="d-none animate-fade">
                        <div class="row">
                            <div class="col-lg-7 mb-4 mb-lg-0">
                                <div class="d-flex align-items-center mb-4"><div class="p-2 bg-warning bg-opacity-10 rounded me-3"><i class="fas fa-balance-scale text-warning"></i></div><h6 class="m-0 text-warning">Pazar Karşılaştırması</h6></div>
                                <div class="p-3 rounded-4 bg-light border"><div style="height: 300px;"><canvas id="rakipGrafigiAnalytics"></canvas></div></div>
                            </div>
                            <div class="col-lg-5">
                                <h6 class="mb-3">Rakip Listesi (Google)</h6>
                                <div class="table-responsive"><table class="table table-hover"><tbody id="modalRakipListesi"></tbody></table></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Fiyat Detay Modalı (Geçmiş Trend Tıklaması İçin) -->
    <div class="modal fade" id="fiyatDetayModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="fiyatDetayModalBaslik">Fiyat Dağılımı</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div style="height:350px"><canvas id="fiyatDetayGrafigiCanvas"></canvas></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Senaryo Raporu Modalı -->
    <div class="modal fade" id="senaryoRaporModal" tabindex="-1" aria-labelledby="senaryoRaporModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="senaryoRaporModalLabel">
                        <i class="fas fa-file-alt me-2"></i>Senaryo Raporu
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="senaryoRaporIcerik">
                    <div class="text-center py-5">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Yükleniyor...</span>
                        </div>
                        <p class="mt-3 text-muted">Rapor yükleniyor...</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="senaryoRaporIndirBtn" onclick="window.senaryoRaporuIndir()">
                        <i class="fas fa-download me-2"></i>PDF İndir
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Kapat</button>
                </div>
            </div>
        </div>
    </div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="app.js"></script>

<!-- Rakip Fiyat Grafiği Scripti -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Sadece Genel Bakış sayfasındaysak çalışsın
    const ctx = document.getElementById('rakipFiyatGrafigi');
    if (ctx) {
        fetch('/api/competitor-prices')
            .then(response => response.json())
            .then(data => {
                new Chart(ctx.getContext('2d'), {
                    type: 'bar',
                    data: data,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'top' },
                            tooltip: {
                                mode: 'index',
                                intersect: false,
                                callbacks: {
                                    label: function(context) {
                                        return context.dataset.label + ': ' + context.parsed.y.toLocaleString('tr-TR') + ' ₺';
                                    }
                                }
                            }
                        },
                        scales: {
                            y: { 
                                beginAtZero: true,
                                grid: { color: 'rgba(0,0,0,0.05)' }
                            },
                            x: {
                                grid: { display: false }
                            }
                        }
                    }
                });
            })
            .catch(err => console.error('Rakip fiyat verileri yüklenemedi:', err));
    }
});
</script>
</body>
</html>